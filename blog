<!doctype html>
<html lang="en"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Farm Stories | AmaniKay</title> 
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&amp;family=Poppins:wght@300;400;600&amp;display=swap" rel="stylesheet"> 
  <script src="https://api.backendless.com/sdk/js/latest/backendless.min.js"></script> 
  <style>
        :root {
            --primary: #006400;
            --accent: #e67e22;
            --text-main: #2c3e50;
            --text-light: #7f8c8d;
            --bg-soft: #fbfaf8;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-soft);
            color: var(--text-main);
            margin: 0;
            line-height: 1.6;
        }

        /* --- Layout --- */
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .blog-header { padding: 80px 5% 40px; text-align: center; }
        h1 { font-family: 'Playfair Display', serif; font-size: 3rem; color: var(--primary); margin: 0; }
        
        .blog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 40px;
            margin: 40px 0 80px;
        }

        /* --- Cards --- */
        .blog-card {
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: 0.3s;
            cursor: pointer;
        }
        .blog-card:hover { transform: translateY(-8px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .card-img { width: 100%; height: 220px; object-fit: cover; }
        .card-body { padding: 25px; }
        .card-body h2 { font-family: 'Playfair Display', serif; font-size: 1.4rem; margin: 0 0 10px; }
        .read-more { color: var(--accent); font-weight: 600; font-size: 0.9rem; text-transform: uppercase; }

        /* --- Full Post Modal --- */
        #post-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            overflow-y: auto;
            backdrop-filter: blur(5px);
            padding: 40px 20px;
        }

        .modal-content {
            background: white;
            max-width: 800px;
            margin: 0 auto;
            border-radius: 20px;
            position: relative;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: sticky;
            top: 20px; left: 92%;
            background: var(--primary);
            color: white;
            border: none;
            width: 40px; height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
        }

        .modal-body { padding: 0 50px 50px; }
        .modal-hero-img { width: 100%; height: 400px; object-fit: cover; border-radius: 20px 20px 0 0; }
        .modal-body h1 { margin-top: 30px; font-size: 2.5rem; line-height: 1.2; }
        .modal-text { font-size: 1.1rem; color: #444; white-space: pre-line; }

        @media (max-width: 600px) {
            .modal-body { padding: 20px; }
            .modal-hero-img { height: 250px; }
        }
    </style> 
 </head> 
 <body> 
  <header class="blog-header"> 
   <h1>The AmaniKay Journal</h1> 
   <p>Climate Smart Stories &amp; Farming Innovation</p> 
  </header> 
  <div class="container"> 
   <main id="blog-container" class="blog-grid"> 
    <p>Loading stories...</p> 
   </main> 
  </div> 
  <div id="post-modal" onclick="closeModal(event)"> 
   <div class="modal-content" onclick="event.stopPropagation()"> <button class="modal-close" onclick="closeModal(event)">×</button> 
    <img id="modal-img" src="" alt="" class="modal-hero-img"> 
    <div class="modal-body"> 
     <h1 id="modal-title"></h1> 
     <p id="modal-date" style="color: var(--text-light); margin-bottom: 20px;"></p> 
     <div id="modal-text" class="modal-text"></div> 
    </div> 
   </div> 
  </div> 
  <script>
    Backendless.initApp("91A41A61-DD6C-481F-ADCA-41A9C5ED0376", "39DB2B85-5B1D-4EA8-8F06-5095CF152ED3");

    let allPosts = []; // Store posts globally to access them for the modal

    async function fetchBlogs() {
        const grid = document.getElementById('blog-container');
        try {
            allPosts = await Backendless.Data.of("BlogPosts").find({
                options: { sortBy: ["created DESC"] }
            });

            grid.innerHTML = allPosts.map((post, index) => `
                <div class="blog-card" onclick="openModal(${index})">
                    <img src="${post.imageurl || 'https://via.placeholder.com/400x220'}" class="card-img">
                    <div class="card-body">
                        <p style="font-size: 0.8rem; color: var(--text-light);">${new Date(post.created).toLocaleDateString()}</p>
                        <h2>${post.title}</h2>
                        <p style="color: #666; font-size: 0.9rem;">${post.content ? post.content.substring(0, 100) : ''}...</p>
                        <span class="read-more">Read Full Story →</span>
                    </div>
                </div>
            `).join('');
        } catch (e) {
            grid.innerHTML = "<p>Error loading stories.</p>";
        }
    }

    function openModal(index) {
        const post = allPosts[index];
        document.getElementById('modal-img').src = post.imageurl || '';
        document.getElementById('modal-title').innerText = post.title;
        document.getElementById('modal-date').innerText = new Date(post.created).toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        document.getElementById('modal-text').innerText = post.content || 'No content available.';
        
        document.getElementById('post-modal').style.display = 'block';
        document.body.style.overflow = 'hidden'; // Stop background scrolling
    }

    function closeModal(e) {
        document.getElementById('post-modal').style.display = 'none';
        document.body.style.overflow = 'auto'; // Enable background scrolling
    }

    window.onload = fetchBlogs;
</script> 
 </body>
</html>
